# Sơ đồ hoạt động hệ thống Dark UI

## 1. Kiến trúc tổng quan

```
┌─────────────────────────────────────────────────────────────────┐
│                    DARK UI SYSTEM                              │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │
│  │   INPUT     │    │   ANIMATION │    │   EFFECTS   │      │
│  │  SYSTEM     │    │   SYSTEM    │    │   SYSTEM    │      │
│  └─────────────┘    └─────────────┘    └─────────────┘      │
│         │                   │                   │             │
│         ▼                   ▼                   ▼             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │
│  │VirtualCursor│    │PanelManager │    │ BlurManager │      │
│  │GamepadInput │    │TabManager   │    │DissolveEffect│     │
│  └─────────────┘    └─────────────┘    └─────────────┘      │
│         │                   │                   │             │
│         ▼                   ▼                   ▼             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │
│  │   AUDIO     │    │   QUALITY   │    │   MODAL     │      │
│  │  SYSTEM     │    │  MANAGER    │    │  WINDOWS    │      │
│  └─────────────┘    └─────────────┘    └─────────────┘      │
└─────────────────────────────────────────────────────────────────┘
```

## 2. Luồng hoạt động chính

### 2.1 Khởi tạo hệ thống

```
┌─────────────────┐
│   Start()       │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ MainPanelManager│
│ - Load panels   │
│ - Set current   │
│ - Play fade in  │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ BlurManager     │
│ - Initialize    │
│ - Set blur 0    │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ UIElementSound  │
│ - Setup Audio   │
│ - Load sounds   │
└─────────────────┘
```

### 2.2 Luồng chuyển đổi Panel

```
┌─────────────────┐
│ User Input      │
│ (Click/Gamepad) │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ PanelAnim()     │
│ - Check index   │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ Current Panel   │
│ - Fade Out      │
│ - Brush Out     │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ Next Panel      │
│ - Fade In       │
│ - Brush In      │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ BlurManager     │
│ - Check index   │
│ - Blur In/Out   │
└─────────────────┘
```

### 2.3 Luồng xử lý âm thanh

```
┌─────────────────┐
│ UI Interaction  │
│ (Hover/Click)   │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ UIElementSound  │
│ - Check enable  │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ AudioSource     │
│ - PlayOneShot() │
└─────────────────┘
```

## 3. Sơ đồ chi tiết các Manager

### 3.1 MainPanelManager

```
┌─────────────────────────────────────────────────────────────┐
│                    MainPanelManager                        │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │   Panels    │  │   Settings  │  │   Blur      │      │
│  │   List      │  │   Config    │  │   Manager   │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
│         │                   │                   │         │
│         ▼                   ▼                   ▼         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │PanelAnim()  │  │NextPage()   │  │PrevPage()   │      │
│  │- Switch     │  │- Forward    │  │- Backward   │      │
│  │- Animate    │  │- Animate    │  │- Animate    │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 PanelTabManager

```
┌─────────────────────────────────────────────────────────────┐
│                    PanelTabManager                         │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │   Panels    │  │   Buttons   │  │   Current   │      │
│  │   List      │  │   List      │  │   Index     │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
│         │                   │                   │         │
│         ▼                   ▼                   ▼         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │PanelAnim()  │  │ButtonAnim() │  │Sync State   │      │
│  │- Fade Out   │  │- Pressed    │  │- Update     │      │
│  │- Fade In    │  │- Normal     │  │- Index      │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 BlurManager

```
┌─────────────────────────────────────────────────────────────┐
│                    BlurManager                             │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │   Material  │  │   Settings  │  │   Animation │      │
│  │   Blur      │  │   Speed     │  │   Coroutine │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
│         │                   │                   │         │
│         ▼                   ▼                   ▼         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │BlurInAnim() │  │BlurOutAnim()│  │SetBlurValue()│     │
│  │- Increase   │  │- Decrease   │  │- Custom     │      │
│  │- Coroutine  │  │- Coroutine  │  │- Value      │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

## 4. Sơ đồ tương tác giữa các component

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   User Input    │───▶│ VirtualCursor   │───▶│ Event System    │
└─────────────────┘    └─────────┬───────┘    └─────────┬───────┘
                                 │                      │
                                 ▼                      ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ UIElementSound  │◀───│   UI Elements   │◀───│   Raycast       │
└─────────┬───────┘    └─────────┬───────┘    └─────────────────┘
          │                      │
          ▼                      ▼
┌─────────────────┐    ┌─────────────────┐
│ AudioSource     │    │ PanelManager    │
└─────────────────┘    └─────────┬───────┘
                                 │
                                 ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ BlurManager     │◀───│   Animation     │───▶│   Quality       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 5. Luồng dữ liệu

### 5.1 Lưu trữ dữ liệu

```
┌─────────────────┐
│ User Action     │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ Component       │
│ - Update Value  │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ PlayerPrefs     │
│ - Save Data     │
└─────────────────┘
```

### 5.2 Tải dữ liệu

```
┌─────────────────┐
│ Start()         │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ PlayerPrefs     │
│ - Load Data     │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ Component       │
│ - Apply Value   │
└─────────────────┘
```

## 6. Sơ đồ trạng thái

### 6.1 Trạng thái Panel

```
┌─────────────┐    Fade In     ┌─────────────┐
│   Hidden    │ ──────────────▶│   Visible   │
└─────────────┘                └─────────────┘
       ▲                             │
       │                             │
       │ Fade Out                    │
       └─────────────────────────────┘
```

### 6.2 Trạng thái Switch

```
┌─────────────┐    Toggle      ┌─────────────┐
│     Off     │ ──────────────▶│     On      │
└─────────────┘                └─────────────┘
       ▲                             │
       │                             │
       │ Toggle                      │
       └─────────────────────────────┘
```

## 7. Sơ đồ tối ưu hóa

### 7.1 Memory Management

```
┌─────────────────┐
│ Object Pool     │
│ - Reuse panels  │
│ - Cache audio   │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ Coroutine      │
│ - Async ops    │
│ - Non-blocking │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ Event System    │
│ - Efficient     │
│ - Delegates     │
└─────────────────┘
```

### 7.2 Performance

```
┌─────────────────┐
│ Frame Rate      │
│ - 60 FPS target │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ Animation       │
│ - Optimized     │
│ - Cached        │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│ Rendering       │
│ - Batched       │
│ - Efficient     │
└─────────────────┘
```

## 8. Tóm tắt

Hệ thống Dark UI hoạt động theo mô hình **Event-Driven Architecture** với:

1. **Input Layer**: Xử lý input từ mouse/gamepad
2. **Logic Layer**: Các Manager xử lý logic
3. **Animation Layer**: Hiệu ứng và transition
4. **Audio Layer**: Âm thanh feedback
5. **Storage Layer**: Lưu trữ cài đặt

Tất cả các layer hoạt động đồng bộ thông qua Unity's Event System và Coroutine system. 